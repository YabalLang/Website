import{u as C,a as k}from"./editor.ab7e0515.js";import{f as x,s as l,z as w,A as E,B as M,C as D,o as z,c as K,a as t,x as _,u as b}from"./entry.ab5adcec.js";import"./github-light.dd84ed5d.js";import"./register-yabal.015ab349.js";import"./toggleHighContrast.d33d4713.js";import"./yabal.dbd77412.js";import"./_commonjsHelpers.de833af9.js";import"./editor.main.7d0c541a.js";const B={class:"flex-fill d-flex flex-column editor-container"},L={class:"border-bottom"},I={class:"d-flex m-2"},R={class:"screen-container m-2"},O=x({__name:"LazyEditor",setup(V){const h=C(),v=l(),u=l(),r=l(),s=k(),n=w(),p=l(!1);let a,i=()=>{};return E(()=>{if(!u.value)return;const d=n.editor.create(v.value,{language:"yabal",theme:h.value?"vs-dark":"github-light"}),o=u.value.getContext("2d"),c=o.createImageData(108,108),y=new Worker("/runtime/worker.js");function f(e){const g=new TextEncoder().encode(e).buffer;y.postMessage(["program",g],[g])}d.addAction({id:"run",label:"Run program",keybindings:[n.KeyCode.F5,n.KeyMod.CtrlCmd|n.KeyCode.KeyR,n.KeyMod.CtrlCmd|n.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(e){f(e.getValue())}}),a=()=>{console.log(r.value.clientWidth),d.layout({width:r.value.clientWidth,height:r.value.clientHeight})},a(),window.addEventListener("resize",a),i=()=>{const e=s.value.code??"";d.setValue(e),p.value&&f(e)},s.value.code&&i(),M(s,e=>{console.log("foo"),e.code&&i()},{deep:!0}),y.onmessage=e=>{if(e.data==="ready"){p.value=!0;const m=s.value.code;m&&f(m)}else c.data.set(e.data),o.putImageData(c,0,0)}}),D(()=>{a&&window.removeEventListener("resize",a)}),(d,o)=>(z(),K("div",B,[t("div",{class:"flex-fill overflow-hidden",ref_key:"editorContainer",ref:r},[t("div",{class:"editor",ref_key:"editorDiv",ref:v},null,512)],512),t("div",L,[t("div",I,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:o[0]||(o[0]=_(c=>b(s).visible=!1,["prevent"]))},"Close editor"),t("button",{type:"button",class:"btn btn-sm btn-primary ms-auto",onClick:o[1]||(o[1]=_(c=>b(i)(),["prevent"]))},"Run code")])]),t("div",R,[t("canvas",{ref_key:"canvas",ref:u,class:"screen",width:"64",height:"64"},null,512)])]))}});export{O as default};
