import{u as E,a as V,c as C}from"./editor.1f471cd7.js";import{f as K,s as u,z as $,A,o as z,c as R,a as o,x as k,u as x}from"./entry.3693c7b6.js";import"./github-light.949b2938.js";import"./register-yabal.00104644.js";import"./toggleHighContrast.ed1e7016.js";import"./yabal.5e728cc3.js";import"./_commonjsHelpers.de833af9.js";import"./editor.main.b76ef616.js";const j={class:"flex-fill d-flex flex-column editor-container"},B={class:"border-bottom"},I={class:"d-flex m-2"},W={class:"screen-container m-2"},J=K({__name:"LazyEditor",setup(L){const w=E(),g=u(),f=u(),m=u(),r=V(),a=$(),_=u(!1);let l=()=>{},e;return A(()=>{if(!f.value)return;e=a.editor.create(g.value,{language:"yabal",theme:w.value?"vs-dark":"github-light"});const v=f.value.getContext("2d"),n=v.createImageData(108,108),c=new Worker("/runtime/worker.js");let y={},d=!1;function p(t){const i=new TextEncoder().encode(t).buffer;d=!0,y={},c.postMessage(["program",i],[i])}e.addAction({id:"run",label:"Run program",keybindings:[a.KeyCode.F5,a.KeyMod.CtrlCmd|a.KeyCode.KeyR,a.KeyMod.CtrlCmd|a.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(t){p(t.getValue())}}),l=()=>{const t=e.getValue();_.value&&p(t)},r.value.code&&(e.setValue(r.value.code),l());const h=e.createDecorationsCollection([]);e.onDidChangeModelContent(()=>{d&&(d=!1,h.set([]))}),c.onmessage=t=>{if(Array.isArray(t.data))switch(t.data[0]){case"ready":{_.value=!0;const s=r.value.code;s&&p(s);break}case"variable":{const[,s,i,b]=t.data,D=`${s}:${i}`;y[D]={range:new a.Range(s,i,s,i+1),options:{after:{content:b.length===1?` = ${b[0].toString()} `:` = [${Array.from(b).join(", ")}] `,inlineClassName:"variable-display-content"}}},d&&h.set(Object.values(y));break}}else n.data.set(t.data),v.putImageData(n,0,0)}}),C("resize",()=>{e==null||e.layout({width:m.value.clientWidth,height:m.value.clientHeight})},{onMount:!0}),C("yabal:update_editor",()=>{r.value.code&&(e.setValue(r.value.code),l())}),(v,n)=>(z(),R("div",j,[o("div",{class:"flex-fill overflow-hidden",ref_key:"editorContainer",ref:m},[o("div",{class:"editor",ref_key:"editorDiv",ref:g},null,512)],512),o("div",B,[o("div",I,[o("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:n[0]||(n[0]=k(c=>x(r).visible=!1,["prevent"]))},"Close editor"),o("button",{type:"button",class:"btn btn-sm btn-primary ms-auto",onClick:n[1]||(n[1]=k(c=>x(l)(),["prevent"]))},"Run code")])]),o("div",W,[o("canvas",{ref_key:"canvas",ref:f,class:"screen",width:"64",height:"64"},null,512)])]))}});export{J as default};
