import{u as E,a as V,c as C}from"./editor.5376dedb.js";import{f as K,s as u,z as $,A,B,o as z,c as R,a,x as k,u as x}from"./entry.a4db21c7.js";import"./github-light.342ba297.js";import"./register-yabal.ae48c1b1.js";import"./toggleHighContrast.6cf8c37a.js";import"./yabal.65a01aee.js";import"./_commonjsHelpers.de833af9.js";import"./editor.main.9dcf9364.js";const j={class:"flex-fill d-flex editor-container"},I={class:"d-flex flex-column flex-fill"},W={class:"d-flex m-2"},L={class:"screen-container p-2"},J=K({__name:"LazyEditor",setup(N){const w=E(),g=u(),f=u(),m=u(),r=V(),o=$(),_=u(!1);let c=()=>{},e;return A(()=>{if(!f.value)return;e=o.editor.create(g.value,{language:"yabal",theme:w.value?"vs-dark":"github-light"});const v=f.value.getContext("2d"),n=v.createImageData(108,108),l=new Worker("/runtime/worker.js");B(()=>{l.terminate()});let p={},d=!1;function y(t){const i=new TextEncoder().encode(t).buffer;d=!0,p={},l.postMessage(["program",i],[i])}e.addAction({id:"run",label:"Run program",keybindings:[o.KeyCode.F5,o.KeyMod.CtrlCmd|o.KeyCode.KeyR,o.KeyMod.CtrlCmd|o.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(t){y(t.getValue())}}),c=()=>{const t=e.getValue();_.value&&y(t)},r.value.code&&(e.setValue(r.value.code),c());const h=e.createDecorationsCollection([]);e.onDidChangeModelContent(()=>{d&&(d=!1,h.set([]))}),l.onmessage=t=>{if(Array.isArray(t.data))switch(t.data[0]){case"ready":{_.value=!0;const s=r.value.code;s&&y(s);break}case"variable":{const[,s,i,b]=t.data,D=`${s}:${i}`;p[D]={range:new o.Range(s,i,s,i+1),options:{after:{content:b.length===1?` = ${b[0].toString()} `:` = [${Array.from(b).join(", ")}] `,inlineClassName:"variable-display-content"}}},d&&h.set(Object.values(p));break}}else n.data.set(t.data),v.putImageData(n,0,0)}}),C("resize",()=>{e==null||e.layout({width:m.value.clientWidth,height:m.value.clientHeight})},{onMount:!0}),C("yabal:update_editor",()=>{r.value.code&&(e.setValue(r.value.code),c())}),(v,n)=>(z(),R("div",j,[a("div",I,[a("div",{class:"flex-fill overflow-hidden",ref_key:"editorContainer",ref:m},[a("div",{class:"editor",ref_key:"editorDiv",ref:g},null,512)],512),a("div",W,[a("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:n[0]||(n[0]=k(l=>x(r).visible=!1,["prevent"]))},"Close editor"),a("button",{type:"button",class:"btn btn-sm btn-primary ms-auto",onClick:n[1]||(n[1]=k(l=>x(c)(),["prevent"]))},"Run code")])]),a("div",L,[a("canvas",{ref_key:"canvas",ref:f,class:"screen",width:"108",height:"108"},null,512)])]))}});export{J as default};
