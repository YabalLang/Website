import{u as k,a as w}from"./editor.d7e9ed09.js";import{f as x,s as c,z as E,A as M,B as D,o as z,c as K,a as t,x as b,u as g}from"./entry.2629bade.js";import"./github-light.1aa92b4f.js";import"./register-yabal.7349a359.js";import"./toggleHighContrast.b5940a17.js";import"./yabal.febb5bd1.js";import"./_commonjsHelpers.de833af9.js";import"./editor.main.745ec585.js";const B={class:"flex-fill d-flex flex-column editor-container"},L={class:"border-bottom"},V={class:"d-flex m-2"},I={class:"screen-container m-2"},O=x({__name:"LazyEditor",setup(R){const h=k(),p=c(),u=c(),i=c(),n=w(),a=E(),y=c(!1);let r,d=()=>{},s;M(()=>{if(!u.value)return;s=a.editor.create(p.value,{language:"yabal",theme:h.value?"vs-dark":"github-light"});const v=u.value.getContext("2d"),o=v.createImageData(108,108),l=new Worker("/runtime/worker.js");function f(e){const _=new TextEncoder().encode(e).buffer;l.postMessage(["program",_],[_])}s.addAction({id:"run",label:"Run program",keybindings:[a.KeyCode.F5,a.KeyMod.CtrlCmd|a.KeyCode.KeyR,a.KeyMod.CtrlCmd|a.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(e){f(e.getValue())}}),r=()=>{console.log(i.value.clientWidth),s.layout({width:i.value.clientWidth,height:i.value.clientHeight})},r(),window.addEventListener("resize",r),d=()=>{const e=s.getValue();y.value&&f(e)},n.value.code&&(s.setValue(n.value.code),d()),l.onmessage=e=>{if(e.data==="ready"){y.value=!0;const m=n.value.code;m&&f(m)}else o.data.set(e.data),v.putImageData(o,0,0)}}),D(()=>{r&&window.removeEventListener("resize",r)});const C=()=>{n.value.code&&(s.setValue(n.value.code),d())};return window.removeEventListener("yabal:update_editor",C),(v,o)=>(z(),K("div",B,[t("div",{class:"flex-fill overflow-hidden",ref_key:"editorContainer",ref:i},[t("div",{class:"editor",ref_key:"editorDiv",ref:p},null,512)],512),t("div",L,[t("div",V,[t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:o[0]||(o[0]=b(l=>g(n).visible=!1,["prevent"]))},"Close editor"),t("button",{type:"button",class:"btn btn-sm btn-primary ms-auto",onClick:o[1]||(o[1]=b(l=>g(d)(),["prevent"]))},"Run code")])]),t("div",I,[t("canvas",{ref_key:"canvas",ref:u,class:"screen",width:"64",height:"64"},null,512)])]))}});export{O as default};
